Deputy
======

A web proxy built on Cowboy and Gun.

It does HTTP proxy calls for plaintext HTTP and accepts the HTTP CONNECT method
to establish a TCP tunnel for TLS and other protocols.

```
+---------+  Plaintext HTTP/1.1 or   +-------+  Plaintext HTTP/1.1  +--------+
|         |    HTTP/2 (port 8080)    |       |   (or HTTP/2)        |        |
|         |------------------------->|       |--------------------->|        |
| Browser |                          | Proxy |                      | Origin |
|         | HTTP/1.1 or HTTP/2 over  |       |  Opaque TCP tunnel   |        |
|         |  TLS (port 8443)         |       | (TLS or other data)  |        |
|         |------------------------->|       |--------------------->|        |
|         |                          |       |                      |        |
+---------+                          +-------+                      +--------+
```

Status
------

This is proxy is created for testing the CONNECT functionality in Cowboy, which
is under development.

* Configuration is hard-coded. Change the code and recomplile to change anything.
* HTTP/2 over plaintext TCP (proxy to origin) is not enabled by default.
* Most browsers don't use HTTP/2 over plaintext TCP.
* CONNECT using HTTP/2 from browser to proxy is untested.

Usage
-----

Start it by running `make shell` and then type
`application:ensure_all_started(deputy).` in the Erlang shell. Then configure a
browser to use localhost and port 8080 as proxy for HTTP and HTTPS. If you want
to connect to the proxy using TLS, configure the browser to accept the
self-signed certificate which is generated by make (requires OpenSSL >= 1.1.1)
and configure the browser to use port 8443 and TLS for the proxy.
